<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
	
<mapper namespace="com.project.springboot.prservice.PReviewDao">
	<!-- 리뷰 글 쓰기 -->
	<insert id="insertReviewDao"
		parameterType="com.project.springboot.productdto.ReviewDTO">
		insert into p_review (r_num, p_num, u_id, p_content, r_rating)
		values (r_num_seq.nextval, #{p_num}, #{u_id}, #{p_content}, #{r_rating})
	</insert>
	
	<!-- 리뷰 이미지 등록 -->
	<insert id="insertRImgDao"
		parameterType="com.project.springboot.productdto.ReviewImageDTO">
		insert into p_revImage (r_num, p_num, r_ofile, r_sfile)
		values (#{r_num}, #{p_num},#{r_ofile}, #{r_sfile})	
	</insert>
	
	<!-- 리뷰 번호 추적 -->
	<select id="checkRnumDao"
		resultType="int">
		select r_num from p_review
		 where p_num = #{param1}
		   and u_id = #{param2}	
	</select>
	
	<!-- 리뷰 가져오기 -->
	<select id="getReviewDao"
		resultType="com.project.springboot.productdto.ReviewDTO">
		select * from p_review where p_num = #{param1}
	</select>
	
	<!-- 리뷰 이미지 가져오기 -->
	<select id="getRevImgDao"
		resultType="com.project.springboot.productdto.ReviewImageDTO">
		select r_num, r_sfile from p_revImage
		 where p_num = #{param1}
	</select>
</mapper>