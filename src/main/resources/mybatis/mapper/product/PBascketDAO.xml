<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
	
<mapper namespace="com.project.springboot.pbservice.PBascketDao">
	<!-- 장바구니 추가 -->
	<insert id="add_bascketDao"
		parameterType="com.project.springboot.productdto.ProductBascketDTO">
		insert into p_bascket
		values (basc_b_num_seq.nextval, #{u_id}, #{p_num}, #{m_qty}, #{p_name}, #{p_listimg}, #{m_price}, #{p_price})
	</insert>
	
	<!-- 장바구니 목록 가져오기 -->
	<select id="get_bascketListDao"
		resultType="com.project.springboot.productdto.ProductBascketDTO">
		select * from p_bascket
		 where u_id = #{param1}
	</select>
	
	<!-- 장바구니 개별 삭제 -->
	<delete id="deleteBascketDao">
		delete from p_bascket
		 where b_num = #{param1}
	</delete>
	
	<!-- 장바구니 결제 상세 O_Num 확인 -->
	<select id="checkO_NumDao"
		resultType="String">
		select *
		  from (
		        select o_num from bascket_order
		         where u_id = #{param1}
		         order by o_num desc
		        )
		where rownum = 1
	</select>
	
	<!-- 장바구니 결제 -->
	<insert id="insertBOrderDao"
		parameterType="com.project.springboot.productdto.BascketOrderDTO">
		insert into bascket_order (o_num, u_id, o_addr, o_price, o_qty)
		values (bOrder_seq.nextval, #{u_id}, #{o_addr}, ${o_price}, ${o_qty})
	</insert>
	
	<!-- 장바구니 결제 상세 -->
	<insert id="insertBOinfoDao">
		insert into b_orderinfo
		values (#{o_num}, #{u_id}, #{p_num}, #{p_name}, #{p_price}, #{bo_qty})
	</insert>
	
	<!-- 장바구니 결제 후 장바구니 삭제 -->
	<delete id="deleteABascketDao">
		delete from p_bascket
		 where u_id = #{param1}
	</delete>
</mapper>