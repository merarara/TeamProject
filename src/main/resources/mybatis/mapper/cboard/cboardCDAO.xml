<?xml version="1.0" encoding="UTF-8"?>

<!-- Mapper파일을 구성하기 위한 Doctype 설정 -->
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.project.springboot.cboard.CommentService">
	<select id="selectC" 
		resultType="com.project.springboot.cboard.CommentDTO">
		
	</select>

	<!-- 페이지설정 -->
	<select id="articlePageDao" resultType="_int">
		select count(*) as total from Comment
	</select>
	
	<!-- insertA 쿼리문에서 UserDTO 클래스를 참조하여 u_id 값을 가져옴 -->
	<insert id="insertC" parameterType="com.project.springboot.cboard.CommentDTO">
	    INSERT INTO AComment (c_num, cc_num, u_id, u_nick, cc_comment) 
	    VALUES (#{c_num}, seq_acomment_num.nextval, #{u_id, jdbcType=VARCHAR}, #{u_nick, jdbcType=VARCHAR}, #{cc_comment})
	</insert>

	<!-- 공지사항 게시글 수정. 파라미터는 DTO의 멤버변수를 사용한다. -->
	<update id="updateC" 
		parameterType="com.project.springboot.cboard.CommentDTO"> 
		update AComment set cc_comment=#{cc_comment} 
		where cc_num=#{cc_num}
	</update> 
	
	<!-- 공지사항 게시글 삭제 -->
	<delete id="deleteC" parameterType="string">
  		delete from AComment where cc_num=#{cc_num}
	</delete>

	<!-- 좋아요 삽입 -->
	<insert id="insertLike" parameterType="map">
	  INSERT INTO c_comment_like (cc_num, u_id) VALUES (#{cc_num}, #{u_id})
	</insert>
	
	<!-- 좋아요 삭제 -->
	<delete id="deleteLike" parameterType="map">
	  DELETE FROM c_comment_like WHERE cc_num = #{cc_num} AND u_id = #{u_id}
	</delete>
	
	<!-- 좋아요 등록 -->
	<update id="getLikeCount"  parameterType="int">
	  UPDATE c_board SET c_like = (
      SELECT COUNT(*) FROM c_comment_like WHERE cc_num = #{cc_num}
      ) WHERE c_num = #{c_num}
	</update>

</mapper>