<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.project.springboot.cboard.C_BoardDAO">
    
<select id="selectCount" resultType="int">
  SELECT COUNT(*) FROM C_Board
  WHERE C_title LIKE '%' || #{searchword, jdbcType=VARCHAR} || '%'
</select>

<!-- C_Board 테이블의 모든 글 목록을 불러오는 SELECT 쿼리문 -->
<select id="selectList" resultType="com.project.springboot.cboard.C_BoardDTO">
  SELECT *
  FROM C_Board
  ORDER BY C_num DESC
</select>


<select id="selectListPage" resultType="com.project.springboot.cboard.C_BoardDTO">
    SELECT *
    FROM (
        SELECT Tb.*, ROWNUM rNum
        FROM (
            SELECT *
            FROM C_Board
            <if test="searchword != null">
                WHERE ${searchField} LIKE '%' || #{searchword, jdbcType=VARCHAR} || '%'
            </if>
            ORDER BY C_num DESC
        ) Tb
    )
    WHERE rNum BETWEEN #{startRow, jdbcType=INTEGER} AND #{endRow, jdbcType=INTEGER}
</select>


    <insert id="insertWrite" parameterType="com.project.springboot.cboard.C_BoardDTO">
        <selectKey keyProperty="C_num" resultType="int" order="BEFORE">
            SELECT C_num_SEQ.NEXTVAL FROM DUAL
        </selectKey>
        INSERT INTO C_Board (
            C_num, U_ID, C_title, C_content, C_ofile, C_sfile
        )
        VALUES (
            #{C_num, jdbcType=INTEGER}, #{U_ID, jdbcType=VARCHAR}, #{C_title, jdbcType=VARCHAR}, #{C_content, jdbcType=VARCHAR}, #{C_ofile, jdbcType=VARCHAR}, #{C_sfile, jdbcType=VARCHAR}
        )
    </insert>

    <update id="updateHit" parameterType="int">
        UPDATE C_Board
        SET C_visitcount = C_visitcount + 1
        WHERE C_num = #{C_num}
    </update>

    <update id="updateBoard" parameterType="com.project.springboot.cboard.C_BoardDTO">
        UPDATE C_Board
        SET C_title = #{C_title},
            C_content = #{C_content},
            C_ofile = #{C_ofile},
            C_sfile = #{C_sfile}
        WHERE C_num = #{C_num}
    </update>

    <delete id="deleteBoard" parameterType="int">
        DELETE FROM C_Board
        WHERE C_num = #{C_num}
    </delete>

    <insert id="insertBoard" parameterType="com.project.springboot.cboard.C_BoardDTO">
        INSERT INTO C_Board (
            C_title, C_content, C_ofile, C_sfile, U_ID, C_postdate, C_downcount, C_pass, C_visitcount
        )
        VALUES (
            #{C_title}, #{C_content}, #{C_ofile}, #{C_sfile}, #{U_ID}, #{C_postdate}, #{C_downcount}, #{C_pass}, #{C_visitcount}
        )
    </insert>
<select id="selectSomeRows" resultType="hashmap">
    SELECT * FROM (
        SELECT ROWNUM rnum, t.*
        FROM (
            SELECT * FROM table
            WHERE id = #{id, jdbcType=VARCHAR}
            ORDER BY some_column ASC
        ) t
    ) WHERE rnum BETWEEN #{startRow, jdbcType=INTEGER} AND #{rowCount, jdbcType=INTEGER}
</select>


</mapper>
