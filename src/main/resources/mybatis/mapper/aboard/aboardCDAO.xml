<?xml version="1.0" encoding="UTF-8"?>

<!-- Mapper파일을 구성하기 위한 Doctype 설정 -->
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.project.springboot.afbService.ACommentService">
	<select id="selectAC" 
		resultType="com.project.springboot.aboard.ACommentDTO">
		
	</select>

	<!-- 페이지설정 -->
	<select id="articlePageDao" resultType="_int">
		select count(*) as total from AComment
	</select>
	
	<!-- insertA 쿼리문에서 UserDTO 클래스를 참조하여 u_id 값을 가져옴 -->
	<insert id="insertAC" parameterType="com.project.springboot.aboard.ACommentDTO">
	    INSERT INTO AComment (a_num, ac_num, u_id, u_nick, ac_comment) 
	    VALUES (#{a_num}, seq_acomment_num.nextval, #{u_id, jdbcType=VARCHAR}, #{u_nick, jdbcType=VARCHAR}, #{ac_comment})
	</insert>

	<!-- 공지사항 게시글 수정. 파라미터는 DTO의 멤버변수를 사용한다. -->
	<update id="updateAC" 
		parameterType="com.project.springboot.aboard.ACommentDTO"> 
		update AComment set ac_comment=#{ac_comment} 
		where ac_num=#{ac_num}
	</update> 
	
	<!-- 공지사항 게시글 삭제 -->
	<delete id="deleteAC" parameterType="string">
  		delete from AComment where ac_num=#{ac_num}
	</delete>

	<!-- 좋아요 삽입 -->
	<insert id="insertLike" parameterType="map">
	  INSERT INTO a_comment_like (ac_num, u_id) VALUES (#{ac_num}, #{u_id})
	</insert>
	
	<!-- 좋아요 삭제 -->
	<delete id="deleteLike" parameterType="map">
	  DELETE FROM a_comment_like WHERE ac_num = #{ac_num} AND u_id = #{u_id}
	</delete>
	
	<!-- 좋아요 등록 -->
	<update id="getLikeCount"  parameterType="int">
	  UPDATE a_board SET a_like = (
      SELECT COUNT(*) FROM a_comment_like WHERE ac_num = #{ac_num}
      ) WHERE a_num = #{a_num}
	</update>

</mapper>